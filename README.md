# AI æ™ºèƒ½æ—…æ¸¸è§„åˆ’åŠ©æ‰‹ï¼ˆåç«¯ï¼‰

> **è®¿é—®åœ°å€**ï¼š[https://www.aitrip.chat/](https://www.aitrip.chat/)  
> **æ¬¢è¿ä½“éªŒæ™ºèƒ½æ—…æ¸¸è§„åˆ’æœåŠ¡ï¼**

## ğŸ“– é¡¹ç›®ç®€ä»‹

**AI-Tourism** æ˜¯ä¸€ä¸ªæ™ºèƒ½æ—…æ¸¸è§„åˆ’ç³»ç»Ÿï¼Œåç«¯åŸºäº **Spring Bootã€LangChain4jã€MySQLã€MyBatisã€Sa-Token** ç­‰æŠ€æœ¯æ ˆæ„å»ºã€‚

ç³»ç»Ÿé›†æˆäº†å¤šç§ AI èƒ½åŠ›ï¼ˆå¦‚ AI Serviceã€MCP å·¥å…·ç­‰ï¼‰ï¼Œä¸ºç”¨æˆ·æä¾›**ä¸ªæ€§åŒ–æ—…æ¸¸è·¯çº¿æ¨èã€å¤šè½®å¯¹è¯ã€æƒé™æ§åˆ¶**ç­‰åŠŸèƒ½ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§
- **å¤šè½®å¯¹è¯ä¸ä¸Šä¸‹æ–‡è®°å¿†** - æ™ºèƒ½ç†è§£ç”¨æˆ·éœ€æ±‚ï¼Œä¿æŒå¯¹è¯è¿è´¯æ€§
- **åœ°å›¾è·¯çº¿å¯è§†åŒ–** - å®æ—¶å±•ç¤ºæ—…æ¸¸è·¯çº¿ï¼Œç›´è§‚æ˜“æ‡‚
- **MCP çµæ´»çƒ­æ’æ‹”** - å·¥å…·å¯åŠ¨æ€å¯ç”¨/ç¦ç”¨ï¼Œæ”¯æŒçƒ­æ’æ‹”
- **Tool ç»Ÿä¸€æ³¨å†Œ** - æ‰€æœ‰å·¥å…·ç»Ÿä¸€ç®¡ç†ï¼Œæ˜“äºæ‰©å±•
- **å®‰å…¨è®¤è¯ä¸æƒé™ç®¡ç†** - å®Œå–„çš„ç”¨æˆ·æƒé™ä½“ç³»

---

### ğŸ–¼ï¸ AI æ™ºèƒ½æ—…æ¸¸è§„åˆ’ å‰ç«¯æ•ˆæœæˆªå›¾
![å‰ç«¯æ•ˆæœå›¾](assets/ç•Œé¢å›¾.png)

### ğŸ“¹ è§†é¢‘æ•ˆæœ
![æ¼”ç¤ºè§†é¢‘](./assets/demo.gif)

**AI æ™ºèƒ½æ—…æ¸¸è§„åˆ’ç³»ç»Ÿ**ï¼Œç»“åˆ `SpringBoot` ä¸ `LangChain4j`ï¼Œåœ¨ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€åï¼Œç”± **AI Agent** è°ƒç”¨ **MCP å·¥å…·**ä¸ **Function Call** è·å–å¤©æ°”ã€æ™¯ç‚¹ç­‰ä¿¡æ¯ï¼Œç”±å‰ç«¯åŒæ—¶æ¸²æŸ“æ–‡å­—ç‰ˆè·¯çº¿è§„åˆ’ä¸ç»“æ„åŒ–åœ°å›¾è·¯çº¿ã€‚

---

## ğŸ’¡ æ ¸å¿ƒç‰¹æ€§ä¸æ¶æ„ç‰¹ç‚¹

![æ ¸å¿ƒç‰¹æ€§ä¸æ¶æ„ç‰¹ç‚¹](assets/æ ¸å¿ƒç‰¹æ€§ä¸æ¶æ„ç‰¹ç‚¹.png)

### 1. Agent æœåŠ¡ä¸åœ°å›¾è·¯çº¿æ¸²æŸ“æ·±åº¦ç»“åˆ
- **å›¾æ–‡ç»“åˆ**ï¼šæä¾›å›¾æ–‡ç»“åˆçš„æ—…æ¸¸æ”»ç•¥ï¼Œå¹¶åœ¨å‰ç«¯åœ°å›¾ä¸­ç›´è§‚å±•ç¤ºæ¯æ—¥è·¯çº¿
- **æµå¼ä¼ è¾“**ï¼šä½¿ç”¨ `SSE` æµå¼ä¼ è¾“æ–‡å­—ç‰ˆæ”»ç•¥ï¼Œå¹¶åŸºäº `JSON Schema` è¾“å‡ºç»“æ„åŒ–æ•°æ®ï¼Œæ”¯æŒå‰ç«¯å®æ—¶æ¸²æŸ“

### 2. åŸºäº Langchain4j çš„ Agent æœåŠ¡
- **ä»»åŠ¡è§„åˆ’**ï¼šåŸºäº `Prompt` å·¥ç¨‹ï¼Œè®¾è®¡è§’è‰²å®šä½ + ä»»åŠ¡ç›®æ ‡ + çº¦æŸé™åˆ¶
- **å·¥å…·è°ƒç”¨**ï¼š`MCP` å·¥å…·é€šè¿‡é…ç½®å¯çµæ´»å¯ç”¨/ç¦ç”¨ï¼Œæ”¯æŒçƒ­æ’æ‹”ï¼›æ‰€æœ‰ `Tool` å·¥å…·å‡å®ç°ç»Ÿä¸€æ¥å£ï¼Œæ³¨å†Œåˆ° `ToolManager`ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ‰©å±•ä¸ç®¡ç†
- **å¤šè½®è®°å¿†**ï¼šå®ç° `ChatMemoryStore`ï¼ŒçŸ­æœŸè®°å¿†ä¼˜å…ˆå­˜å‚¨äº `Redis`ï¼Œæœªå‘½ä¸­è‡ªåŠ¨å›é€€æ•°æ®åº“ï¼Œ`AI Service` å®ä¾‹ä»¥ä¼šè¯ä¸ºå•ä½ç¼“å­˜ï¼Œæ”¯æŒå¤šç”¨æˆ·å¹¶å‘ä¸ä¸Šä¸‹æ–‡éš”ç¦»
- **ç»“æ„åŒ–è¾“å‡ºè·¯çº¿**ï¼šåŸºäº `JSON Schema` è¾“å‡ºç»“æ„åŒ–è·¯çº¿æ•°æ®ï¼Œç”¨äºå‰ç«¯åœ°å›¾æ¸²æŸ“å±•ç¤º
- **å®‰å…¨é˜²èŒƒ**ï¼š`LangChain4j` è¾“å…¥æŠ¤è½¨æœºåˆ¶ï¼Œå‰ç½®æ ¡éªŒè¯·æ±‚å†…å®¹ï¼Œé˜²æ­¢æ•æ„Ÿè¯ä¸ `Prompt` æ³¨å…¥æ”»å‡»ï¼Œä¿éšœç³»ç»Ÿç¨³å®šæ€§

### 3. ç»Ÿä¸€å·¥å…·æ³¨å†Œä¸é«˜æ€§èƒ½è°ƒç”¨é˜²æŠ–
- **MCP å·¥å…·**ï¼šé€šè¿‡é…ç½®å¯çµæ´»å¯ç”¨/ç¦ç”¨ï¼Œæ”¯æŒçƒ­æ’æ‹”
- **Function Call å·¥å…·**ï¼šé€šè¿‡ `ToolManager` ç»Ÿä¸€æ³¨å†Œä¸è°ƒåº¦ï¼Œæ”¯æŒè¿è¡Œæ—¶æ‰©å±•
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¼•å…¥ `Caffeine` ç¼“å­˜ï¼Œé¿å…é‡å¤è°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼Œ**å¹³å‡å“åº”è€—æ—¶ä» 5.20s ä¸‹é™è‡³ 399Î¼s**

### 4. å¤šè½®å¯¹è¯è®°å¿†ä¸å®ä¾‹éš”ç¦»
- **è®°å¿†ç®¡ç†**ï¼šç»“åˆ `Redis` ä¸æ•°æ®åº“å®ç°çŸ­æœŸè®°å¿†ï¼Œä½¿ç”¨æ•°æ®åº“å®ç°ä¼šè¯å†å²
- **å®ä¾‹ç¼“å­˜**ï¼šåŸºäº `Caffeine` ç¼“å­˜ `AI Service` å®ä¾‹ï¼Œæ”¯æŒä¼šè¯éš”ç¦»ï¼Œæå‡æœåŠ¡å“åº”æ€§èƒ½å¹¶å‡å°‘å®ä¾‹é‡å¤åˆ›å»º
- **æ€§èƒ½æå‡**ï¼šå®ä¾‹å¹³å‡åˆ›å»ºæ—¶é—´ç”± **13.1ms é™ä½è‡³ 9.74msï¼Œæ€§èƒ½æå‡ 28.4%**

### 5. AI è¾“å…¥æŠ¤è½¨ä¸ç»“æ„åŒ–è¾“å‡º
- **å®‰å…¨æ ¡éªŒ**ï¼šè¯·æ±‚å‰ç½®æ ¡éªŒï¼Œè‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿè¯ã€æ¶æ„æ³¨å…¥ç­‰é£é™©å†…å®¹ï¼Œä¿éšœç³»ç»Ÿå®‰å…¨

### 6. Sa-Token æƒé™è®¤è¯
- **ä»¤ç‰Œæœºåˆ¶**ï¼š`JWT` çŸ­æœŸä»¤ç‰Œ + `Refresh Token` é•¿æœŸä»¤ç‰Œç»“åˆ
- **æƒé™æ§åˆ¶**ï¼šæ³¨è§£å¼æƒé™æ§åˆ¶ï¼Œç»†ç²’åº¦è§’è‰²ç®¡ç†

### 7. SpringBoot å·¥ç¨‹åŒ–ä¸ RESTful è®¾è®¡
- **åˆ†å±‚æ¶æ„**ï¼šæ ‡å‡†çš„åˆ†å±‚æ¶æ„ï¼ˆ`Controller` - `Service` - `Mapper`ï¼‰
- **æ¥å£è§„èŒƒ**ï¼šæ¥å£ç»Ÿä¸€ï¼Œç¬¦åˆ `RESTful` è§„èŒƒï¼Œæ˜“äºå‰åç«¯åä½œ

---

## ğŸ—ï¸ ç³»ç»Ÿæ•´ä½“æ¶æ„



- **å‰ç«¯ï¼ˆai-tourism-frontendï¼‰**ï¼š`Vue` åº”ç”¨ï¼Œè´Ÿè´£äº¤äº’ã€åœ°å›¾æ¸²æŸ“ä¸å¯¹è¯å±•ç¤ºï¼›é€šè¿‡ `SSE` è°ƒç”¨ `POST /ai_assistant/chat-stream` å®æ—¶æ¶ˆè´¹æ¨¡å‹è¾“å‡º

- **æ¥å…¥å±‚ï¼ˆController + é‰´æƒï¼‰**ï¼šåŸºäº `Spring Boot REST`ï¼Œä½¿ç”¨ `Sa-Token` è¿›è¡Œç™»å½•ä¸æƒé™æ ¡éªŒï¼ˆå¦‚ `@SaCheckLogin`ã€`@SaCheckPermission`ï¼‰

- **æœåŠ¡å±‚ï¼ˆMemoryChatServiceImplï¼‰**ï¼šç»Ÿä¸€å¤„ç†è¯·æ±‚æ ¡éªŒã€è·å–ä¼šè¯å†å²ã€è·å–ä¼šè¯åˆ—è¡¨ã€æ¶ˆæ¯å…¥åº“ã€`SSE` æµå¼è¿”å›

- **AI Serviceï¼ˆMemoryAssistantServiceFactoryï¼‰**ï¼šæŒ‰ä¼šè¯æ„å»ºéš”ç¦»çš„ `AssistantService` å®ä¾‹ï¼Œæ•´åˆ `OpenAI` æµå¼æ¨¡å‹ã€`MessageWindowChatMemory`ï¼ˆåŸºäº `ChatMemoryStore`ï¼‰ã€è¾“å…¥æŠ¤è½¨ã€å·¥å…·è°ƒç”¨ï¼›åŒæ—¶ä½¿ç”¨ `Caffeine` æŒ‰ `sessionId` ç¼“å­˜å®ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»º

- **è®°å¿†ä¸å†å²ï¼ˆRedis + MySQLï¼‰**ï¼š
  - **çŸ­æœŸå¯¹è¯è®°å¿†**ï¼š`CustomRedisChatMemoryStore` åŸºäº `Redis` è¿›è¡Œç®¡ç†ï¼ŒåŒæ—¶æ”¯æŒ `MySQL` æ¶ˆæ¯å¡«å…¥
  - **é•¿æœŸå†å²ä¸ç»“æ„åŒ–æ•°æ®**ï¼šé€šè¿‡ `MyBatis` å†™å…¥ `MySQL`ï¼ˆä¼šè¯è¡¨ã€æ¶ˆæ¯è¡¨ã€è·¯çº¿ JSONï¼‰

- **å·¥å…·è°ƒç”¨ï¼ˆFunction Call + MCPï¼‰**ï¼š
  - **Function Call**ï¼š`ToolManager` ç»Ÿä¸€æ³¨å†Œæ‰€æœ‰ `BaseTool`
  - **MCP**ï¼šåŸºäº `LangChain4j MCP`ï¼Œ`McpClientService` é€šè¿‡ `SSE` åˆ›å»º `ToolProvider`

- **ç¼“å­˜ä¸é˜²æŠ–**ï¼š
  - **Caffeine**ï¼šç¼“å­˜ `AssistantService` å®ä¾‹
  - **Redis**ï¼šæ‰¿è½½å¯¹è¯è®°å¿†ï¼Œé™ä½æ•°æ®åº“è¯»å†™å‹åŠ›

- **å¯è§‚æµ‹æ€§ä¸ç›‘æ§**ï¼š`Micrometer` æš´éœ² `Prometheus` æŒ‡æ ‡ï¼ˆç®¡ç†ç«¯ç‚¹å·²å¼€æ”¾ `prometheus`ï¼‰ï¼›`AiModelMonitorListener`/`AiModelMetricsCollector` è®°å½•è¯·æ±‚é‡ã€è€—æ—¶ã€Token ä½¿ç”¨ã€é”™è¯¯ç‡ã€ç¼“å­˜å‘½ä¸­ç­‰ï¼›Grafana ä»ªè¡¨ç›˜è§ `doc/Prometheus-Grafana.json`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‚ ç›®å½•ç»“æ„

```
ai-tourism/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/example/aitourism/
â”‚   â”‚   â”‚   â”œâ”€â”€ ai/                  # AI Agentã€å·¥å…·ã€è®°å¿†ã€æŠ¤è½¨ç­‰æ ¸å¿ƒAIèƒ½åŠ›
â”‚   â”‚   â”‚   â”œâ”€â”€ config/              # é…ç½®ç±»ï¼ˆå¦‚Sa-Tokenã€CORSã€Redisç­‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/          # REST API æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ dto/                 # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/              # å®ä½“ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ exception/           # å…¨å±€å¼‚å¸¸å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/              # MyBatis æ˜ å°„
â”‚   â”‚   â”‚   â”œâ”€â”€ monitor/             # ç›‘æ§ä¸åŸ‹ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ service/             # ä¸šåŠ¡é€»è¾‘ä¸AIé›†æˆ
â”‚   â”‚   â”‚   â””â”€â”€ util/                # å·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml      # ä¸»è¦é…ç½®æ–‡ä»¶
â”‚   â”‚       â””â”€â”€ prompt/              # AI Prompt æ¨¡æ¿
â”œâ”€â”€ sql/
â”‚   â””â”€â”€ create_table.sql             # æ•°æ®åº“è¡¨ç»“æ„
â”œâ”€â”€ doc/
â”‚   â”œâ”€â”€ API.md                       # æ¥å£æ–‡æ¡£
â”‚   â””â”€â”€ Prometheus-Grafana.json      # ç›‘æ§ä»ªè¡¨ç›˜é…ç½®
â”œâ”€â”€ pom.xml                          # Maven ä¾èµ–
â””â”€â”€ README.md
```

### ğŸ› ï¸ æŠ€æœ¯æ ˆä¸ä¾èµ–

| æŠ€æœ¯åˆ†ç±» | æŠ€æœ¯æ ˆ | ç‰ˆæœ¬/è¯´æ˜ |
|---------|--------|----------|
| **æ ¸å¿ƒæ¡†æ¶** | Java | `21` |
| | Spring Boot | `3.5.6` |
| **AI èƒ½åŠ›** | LangChain4j | AIèƒ½åŠ›é›†æˆ |
| **æ•°æ®åº“** | MySQL | `9.4` |
| **ORM** | MyBatis & MyBatis-Spring-Boot | æ•°æ®æŒä¹…åŒ– |
| **å®‰å…¨è®¤è¯** | Sa-Token | JWT è®¤è¯ä¸æƒé™ |
| | BCrypt | å¯†ç åŠ å¯† |
| **å·¥å…·åº“** | Lombok | ä»£ç ç®€åŒ– |
| | OkHttp3 | HTTP å®¢æˆ·ç«¯ |
| | Hutool | å·¥å…·åº“ |
| **ç¼“å­˜** | Caffeine | æœ¬åœ°é«˜æ€§èƒ½ç¼“å­˜ |
| | Redis | åˆ†å¸ƒå¼ç¼“å­˜ä¸å¯¹è¯è®°å¿† |
| **ç›‘æ§** | Prometheus + Grafana | ç›‘æ§ä¸å¯è§†åŒ– |
| | Micrometer | Spring Boot ç›‘æ§åŸ‹ç‚¹ |

> è¯¦è§ [pom.xml](pom.xml) ä¾èµ–é…ç½® 

### ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

#### ä¸»è¦è¡¨è®¾è®¡

| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ |
|------|------|----------|
| `t_user` | ç”¨æˆ·è¡¨ | æ‰‹æœºå·ã€åŠ å¯†å¯†ç ã€æ˜µç§°ã€å¤´åƒã€çŠ¶æ€ç­‰ |
| `t_role` | è§’è‰²è¡¨ | USERã€ROOT ç­‰è§’è‰² |
| `t_permission` | æƒé™è¡¨ | æƒé™æ ‡è¯†ã€æƒé™åç§°ç­‰ |
| `t_user_role` | ç”¨æˆ·-è§’è‰²å…³è”è¡¨ | ç”¨æˆ·IDã€è§’è‰²ID |
| `t_role_permission` | è§’è‰²-æƒé™å…³è”è¡¨ | è§’è‰²IDã€æƒé™ID |
| `t_refresh_token` | åˆ·æ–°ä»¤ç‰Œè¡¨ | ç”¨æˆ·IDã€ä»¤ç‰Œå€¼ã€è¿‡æœŸæ—¶é—´ç­‰ |
| `t_ai_assistant_sessions` | ä¼šè¯åˆ—è¡¨ | ä¼šè¯IDã€ç”¨æˆ·IDã€ä¼šè¯æ ‡é¢˜ç­‰ |
| `t_ai_assistant_chat_messages` | AIåŠ©æ‰‹æ¶ˆæ¯è¡¨ | æ¶ˆæ¯IDã€ä¼šè¯IDã€æ¶ˆæ¯å†…å®¹ã€è§’è‰²ç­‰ |
| `t_poi` | æ™¯ç‚¹POIæ•°æ® | æ™¯ç‚¹åã€æ‰€å±åŸå¸‚ã€æ™¯ç‚¹æè¿° |

> è¯¦ç»†å­—æ®µå’Œçº¦æŸè¯·å‚è€ƒ [sql/create_table.sql](sql/create_table.sql)

### âš™ï¸ é…ç½®è¯´æ˜

ä¸»è¦é…ç½®é¡¹åœ¨ `src/main/resources/application.yml`ï¼š

- **åŸºç¡€é…ç½®**ï¼šç«¯å£ã€æ•°æ®åº“è¿æ¥ã€æ—¥å¿—ã€MyBatis ç­‰
- **å®‰å…¨è®¤è¯**ï¼šSa-Token JWT å¯†é’¥ã€token è¿‡æœŸæ—¶é—´ã€æƒé™æ³¨è§£ç­‰  
- **AI æœåŠ¡**ï¼šOpenAI/MCP ç­‰ AI æœåŠ¡å‚æ•°

### ğŸ”— æ¥å£è¯´æ˜

#### ç”¨æˆ·ä¸è®¤è¯ç›¸å…³

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/auth/login` | `POST` | ç”¨æˆ·ç™»å½•ï¼Œè¿”å› tokenã€ç”¨æˆ·ä¿¡æ¯ç­‰ |
| `/auth/register` | `POST` | ç”¨æˆ·æ³¨å†Œï¼Œè‡ªåŠ¨åˆ†é… USER è§’è‰² |
| `/auth/me` | `GET` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯åŠè§’è‰² |
| `/auth/refresh` | `POST` | åˆ·æ–° tokenï¼Œæå‡å®‰å…¨æ€§ä¸ä½“éªŒ |
| `/auth/logout` | `POST` | ç™»å‡ºï¼Œæ¸…ç†ä¼šè¯ |
| `/auth/disable` | `POST` | ç¦ç”¨ç”¨æˆ·ï¼ˆéœ€æƒé™ï¼‰ |
| `/auth/set_root` | `POST` | ROOT æˆæƒï¼ˆéœ€æƒé™ï¼‰ |

#### AI åŠ©æ‰‹ç›¸å…³

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/ai_assistant/chat` | `POST` | å‘èµ· AI æµå¼å¯¹è¯ï¼Œè¿”å›æ—…æ¸¸è·¯çº¿å»ºè®® |
| `/ai_assistant/get_history` | `POST` | è·å–ä¼šè¯å†å²ï¼Œæ”¯æŒå¤šè½®è¿½æº¯ |
| `/ai_assistant/session_list` | `POST` | è·å–å†å²ä¼šè¯åˆ—è¡¨ï¼Œåˆ†é¡µå±•ç¤º |

> è¯¦ç»†å‚æ•°ä¸è¿”å›æ ¼å¼è¯·å‚è€ƒ [doc/API.md](doc/API.md)

---


## ğŸ“Š ç›‘æ§ä¸å¯è§‚æµ‹æ€§ï¼ˆPrometheus + Grafanaï¼‰

ç³»ç»Ÿå·²é›†æˆ **Prometheus + Grafana** å®ç°å…¨é“¾è·¯ç›‘æ§ï¼Œè¦†ç›– AI æœåŠ¡è°ƒç”¨ã€å·¥å…·ç¼“å­˜å‘½ä¸­ã€Token æ¶ˆè€—ã€å“åº”è€—æ—¶ã€é”™è¯¯ç‡ç­‰æ ¸å¿ƒæŒ‡æ ‡ã€‚

### 1. æ•°æ®é‡‡é›†
- **æŒ‡æ ‡é‡‡é›†**ï¼šä½¿ç”¨ `Micrometer` æŒ‡æ ‡é‡‡é›†é—¨é¢åº“ï¼Œå®ƒé›†æˆåœ¨ `Spring Boot Actuator` ä¸­ã€‚`Micrometer` æä¾›äº†ä¸€å¥—ç»Ÿä¸€çš„ API æ¥å®šä¹‰å’Œè®°å½•æŒ‡æ ‡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†è¿™äº›æŒ‡æ ‡è½¬æ¢ä¸ºå¤šç§ç›‘æ§ç³»ç»Ÿæ‰€éœ€çš„æ ¼å¼ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ `Prometheus`
- **æŒ‡æ ‡å®šä¹‰**ï¼šåˆ›å»ºäº†ä¸€ä¸ª `AiModelMetricsCollector` ç±»ï¼Œåœ¨å…¶ä¸­ä½¿ç”¨ `Micrometer API` å®šä¹‰æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡ï¼Œä¸»è¦åŒ…æ‹¬ï¼š
  - **Counter**ï¼šç”¨äºç»Ÿè®¡ç´¯è®¡å€¼ï¼Œå¦‚ AI è¯·æ±‚æ€»æ•°ã€Token æ¶ˆè€—æ€»é‡ã€é”™è¯¯æ€»æ•°
  - **Timer**ï¼šç”¨äºè®°å½•è€—æ—¶åˆ†å¸ƒï¼Œå¦‚ AI å“åº”æ—¶é•¿
- **ç›‘å¬æœºåˆ¶**ï¼šå®ç° `ChatModelListener` æ¥å£ï¼Œé‡å†™ `onRequest`ã€`onResponse`ã€`onError` ç­‰æ–¹æ³•ï¼Œç”¨äºç›‘å¬å¯¹åº”çš„å…³é”®äº‹ä»¶ï¼Œç„¶ååœ¨å…¶ä¸­è°ƒç”¨ `AiModelMetricsCollector` æ¥å®æ—¶è®°å½•å®šä¹‰çš„æŒ‡æ ‡
- **ç«¯ç‚¹æš´éœ²**ï¼š`Spring Boot Actuator` ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª `/actuator/prometheus` ç«¯ç‚¹ï¼Œå°† `Micrometer` é‡‡é›†çš„æ‰€æœ‰æŒ‡æ ‡ä»¥ `Prometheus` è¦æ±‚çš„æ–‡æœ¬æ ¼å¼æš´éœ²å‡ºæ¥

### 2. æ•°æ®å­˜å‚¨
- **Prometheus é…ç½®**ï¼šéœ€è¦éƒ¨ç½²ç‹¬ç«‹çš„ `Prometheus` æœåŠ¡ï¼Œåœ¨å…¶é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æŠ“å–ä»»åŠ¡ï¼Œè®©å…¶å®šæœŸæŠ“å–åç«¯åº”ç”¨æš´éœ²çš„ `/actuator/prometheus` ç«¯ç‚¹çš„æ•°æ®
- **é…ç½®ç¤ºä¾‹**ï¼š
  ```yaml
  - job_name: "ai-tourism"
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s
    static_configs:
      - targets: ["localhost:8290"]
        labels:
          group: "prod"
          endpoint: "actuator"
  ```
- **æ•°æ®å­˜å‚¨**ï¼š`Prometheus` ä¼šå°†è¿™äº›æ—¶åºæ•°æ®é«˜æ•ˆåœ°å­˜å‚¨åœ¨å®ƒå†…ç½®çš„ `TSDB` æ—¶åºæ•°æ®åº“ä¸­

### 3. æ•°æ®å±•ç¤º
- **Grafana è¿æ¥**ï¼šåœ¨ `Grafana` ä¸­è¿æ¥ `Prometheus` æœåŠ¡æ•°æ®
- **ä»ªè¡¨ç›˜åˆ›å»º**ï¼šåˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ç›‘æ§ä»ªè¡¨ç›˜ï¼Œé€šè¿‡ç¼–å†™ `PromQL` æŸ¥è¯¢è¯­å¥ï¼Œå°†å­˜å‚¨åœ¨ `Prometheus` ä¸­çš„åŸå§‹æŒ‡æ ‡æ•°æ®èšåˆæˆæœ‰æ„ä¹‰çš„å¯è§†åŒ–å›¾è¡¨

### 4. ç›‘æ§å†…å®¹
- **AI æ¨¡å‹æŒ‡æ ‡**ï¼šæ€»è¯·æ±‚æ•°ã€æˆåŠŸç‡ã€å¹³å‡å“åº”æ—¶é—´ã€Token æ¶ˆè€—è¶‹åŠ¿
- **æ€§èƒ½å¯¹æ¯”**ï¼šAI Service å®ä¾‹åˆ›å»ºæ—¶é—´å¯¹æ¯”ï¼ˆç¼“å­˜/éç¼“å­˜ï¼‰
- **ç¼“å­˜æ•ˆæœ**ï¼šå·¥å…·ç¼“å­˜å‘½ä¸­ç‡ã€è°ƒç”¨å“åº”æ—¶é—´å¯¹æ¯”ï¼ˆç¼“å­˜/éç¼“å­˜ï¼‰
- **ç”¨æˆ·æ´»è·ƒ**ï¼šç”¨æˆ·/ä¼šè¯æ´»è·ƒæ’è¡Œã€é”™è¯¯ç±»å‹åˆ†å¸ƒç­‰

### 5. Grafana å¤§ç›˜æˆªå›¾
![ä»ªè¡¨ç›˜](./assets/ä»ªè¡¨ç›˜.png)

> **å…·ä½“ Grafana é…ç½®**å¯å‚è€ƒ é…ç½®æ–‡ä»¶ [doc/Prometheus-Grafana.json](doc/Prometheus-Grafana.json)

---

## ğŸ›« éƒ¨ç½²ä¸è¿è¡Œ

### ğŸ“‹ ç¯å¢ƒè¦æ±‚
1. **JDK 21** - Java è¿è¡Œç¯å¢ƒ
2. **Maven** - é¡¹ç›®æ„å»ºå·¥å…·
3. **MySQL 9.4** - æ•°æ®åº“
4. **Redis 3.0** - ç¼“å­˜æœåŠ¡

### ğŸš€ éƒ¨ç½²æ­¥éª¤

#### 1ï¸. ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£… JDK 21
# å®‰è£… MySQL 9.4
# å®‰è£… Redis 3.0
```

#### 2ï¸. æ•°æ®åº“åˆå§‹åŒ–
```bash
# æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
mysql -u root -p < sql/create_table.sql
```

#### 3ï¸. é…ç½®æ–‡ä»¶
ç¼–è¾‘ `src/main/resources/application.yml`ï¼š
- é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯
- é…ç½® AI API Key
- é…ç½®å…¶ä»–å¿…è¦å‚æ•°

#### 4ï¸. æ„å»ºè¿è¡Œ
```bash
# æ„å»ºé¡¹ç›®
mvn clean package

# è¿è¡Œé¡¹ç›®
java -jar target/ai-tourism-0.0.1-SNAPSHOT.jar
```

#### 5ï¸. å‰ç«¯éƒ¨ç½²
å‰ç«¯è¯·å‚è€ƒ [ai-tourism-frontend ä»“åº“](https://github.com/1937983507/ai-tourism-frontend)

---

## ğŸ“¬ è”ç³»ä¸è´¡çŒ®

æ¬¢è¿ä»»ä½•å»ºè®®ã€åé¦ˆä¸è´¡çŒ®ï¼å¦‚éœ€äº¤æµæˆ–æœ‰åˆä½œæ„å‘ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- **å¾®ä¿¡**ï¼š`13859211947`
- **GitHub**ï¼šæäº¤ Issue æˆ– PR åˆ°æœ¬ä»“åº“
- **å‰ç«¯é¡¹ç›®**ï¼š[ai-tourism-frontend ä»“åº“](https://github.com/1937983507/ai-tourism-frontend)

å¦‚æœ‰ Bugã€éœ€æ±‚æˆ–æƒ³æ³•ï¼Œæ¬¢è¿éšæ—¶æå‡ºï¼Œæˆ‘ä»¬ä¼šç§¯æå“åº”ã€‚
ä¹Ÿæ¬¢è¿ Java + AI åº”ç”¨å¼€å‘ç›¸å…³çš„åŒå­¦ä¸€èµ·äº¤æµè®¨è®ºã€‚

---

## ğŸ“ License

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ ä½¿ç”¨ï¼Œ**ç¦æ­¢æœªç»æˆæƒçš„å•†ç”¨**ã€‚

---

## ğŸ“‹ TODO list

### 1. AI Service æ¨¡å—
- [ ] æœ‰æ—¶ AI è§„åˆ’çš„è·¯çº¿å¯èƒ½ä¼šç»•è·¯ï¼Œæ‰€ä»¥éœ€è¦å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚åŠ ä¸€ä¸ªåœ°ç†ç¼–ç çš„ MCP æœåŠ¡ã€‚
- [ ] å¯ä»¥æä¾›æ›´å¤šçš„ MCP æœåŠ¡ï¼Œä¾‹å¦‚å›¾ç‰‡æ£€ç´¢ä¹‹ç±»ã€‚
- [ ] å°†è°ƒç”¨çš„å·¥å…·ä¹Ÿä¸€èµ·åœ¨å‰ç«¯æ¸²æŸ“æ˜¾ç¤ºã€‚
- [ ] å¯é‡‡ç”¨ **å¯¹è¯å¼å¼•å¯¼è§„åˆ’**ï¼Œå…ˆé€šè¿‡å¤šè½®é—®ç­”ç¡®è®¤ç”¨æˆ·çš„åå¥½ã€äººæ•°ã€é¢„ç®—ã€èŠ‚å¥ï¼Œåç«¯å¼•å…¥ Prompt æ¨¡æ¿åŒ–ä¸å¤ç”¨æœºåˆ¶ï¼ˆå¤šç§æ—…è¡Œé£æ ¼æ¨¡æ¿ï¼‰ï¼ŒAIæ ¹æ®æ„å›¾è‡ªåŠ¨åˆ‡æ¢ã€‚
- [ ] å¼•å…¥ **RAG**ï¼Œå¯¹äºæŸä¸€åŸå¸‚çš„æ™¯ç‚¹å†…å®¹ï¼Œå¯ä»¥å­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œè‹¥æ˜¯èƒ½æ£€ç´¢åˆ°åˆ™ç›´æ¥äº¤ç»™å¤§æ¨¡å‹è¾“å‡ºï¼›è‹¥æ˜¯æ£€ç´¢ä¸åˆ°åˆ™è°ƒç”¨MCPæœåŠ¡è¿›è¡Œæ£€ç´¢ã€‚ï¼ˆæ­¤æ—¶éœ€è¦ä»é©¬èœ‚çªã€å°çº¢ä¹¦ã€æºç¨‹ç­‰å¹³å°çˆ¬å–åˆ°è¶³å¤Ÿé‡çš„æ™¯ç‚¹ä»‹ç»+ç”¨æˆ·æ¸¸è®°ï¼‰
- [ ] å¼•å…¥ **LangGraph4j**ï¼Œè§£å†³ç›´æ¥è°ƒç”¨ AI Service æ—¶å­˜åœ¨çš„æµç¨‹ä¸å¯æ§ã€ä»»åŠ¡è€¦åˆåº¦é«˜ã€æ‰©å±•æ€§è¾ƒå·®çš„é—®é¢˜ã€‚
  - **æµç¨‹ä¸å¯æ§**ï¼šæ‰€æœ‰çš„è¿‡ç¨‹éƒ½è¢«å°è£…åˆ°å•ä¸€çš„AIæœåŠ¡ä¸­ï¼Œå¾ˆéš¾å¹²é¢„å…¶ä¸­é—´è¿‡ç¨‹ã€‚ï¼ˆä¾‹å¦‚æˆ‘å¸Œæœ›å®ƒå…ˆè¿›è¡Œå¤©æ°”æŸ¥è¯¢ã€ç„¶åè¿›è¡Œæ™¯ç‚¹æŸ¥è¯¢ã€ç„¶åæœå¯»æ™¯ç‚¹çš„ç…§ç‰‡ï¼Œè¿™æ ·ä¸€ä¸ªæµç¨‹ï¼Œéš¾ä»¥æ§åˆ¶ä¸å¹²é¢„ï¼‰ã€‚
  - **ä»»åŠ¡è€¦åˆ**ï¼šå°†é€»è¾‘ä¸Šç‹¬ç«‹çš„æ­¥éª¤ï¼Œéƒ½è€¦åˆåœ¨ä¸€ä¸ªå·¨å¤§çš„ç³»ç»Ÿæç¤ºè¯é‡Œé¢ï¼Œä¸ä»…ä½¿å¾—æç¤ºè¯éš¾ä»¥ç»´æŠ¤ä¸å¼‚å¸¸å¤æ‚ã€åŒæ—¶å¢åŠ äº†AIç†è§£å’Œæ‰§è¡Œä»»åŠ¡çš„éš¾åº¦ã€‚
  - **æ‰©å±•æ€§å·®**ï¼šè‹¥æ˜¯æƒ³åœ¨æµç¨‹ä¸­æ·»åŠ æ–°çš„æ­¥éª¤ï¼Œåˆ™åœ¨ç›®å‰çš„æ¨¡å¼ä¸‹åªèƒ½é€šè¿‡ä¿®æ”¹ç³»ç»Ÿæç¤ºè¯è¿›è¡Œè§£å†³ã€‚
- [ ] é€šè¿‡ **Redisson** å®ç°åˆ†å¸ƒå¼é™æµï¼Œé˜²æ­¢æ¶æ„è¯·æ±‚å’Œèµ„æºæ»¥ç”¨ã€‚
- [ ] **Redis** éƒ¨åˆ†çš„æ‰©å±•è¡¥å……ï¼ŒåŸºäºæ—è·¯ç¼“å­˜ç­–ç•¥å¯¹æ•°æ®ä¸€è‡´æ€§è¿›è¡Œä¿®å¤ã€‚
- [ ] é’ˆå¯¹ç”¨æˆ·ç•™å­˜ï¼Œé€šè¿‡è®°å¿†æ„å»ºç”¨æˆ·ä¸ªæ€§åŒ–æ¡£æ¡ˆï¼ˆå¦‚æ—…æ¸¸åå¥½ï¼‰ã€‚
- [ ] åŸºäº A2A åè®®å®ç°å¤šä¸ª Agent ä¹‹é—´çš„ååŒå·¥ä½œï¼Œä¾‹å¦‚å¯ä»¥æ‹†åˆ†ä¸ºï¼š
  - æ„å›¾ç†è§£ Agentï¼šè§£æç”¨æˆ·çš„åå¥½ã€é¢„ç®—ã€å¤©æ•°
  - æ™¯ç‚¹å¬å› Agentï¼šä» RAG æˆ– MCP ä¸­æ£€ç´¢å€™é€‰æ™¯ç‚¹ã€‚
  - è·¯å¾„è§„åˆ’ Agentï¼šåŸºäºåœ°ç†ç¼–ç ç»“æœè·å–æ™¯ç‚¹åæ ‡ï¼Œå¹¶ä¼˜åŒ–ä¸²è”æ™¯ç‚¹é¡ºåºã€‚
  - å¤©æ°”äº¤é€š Agentï¼šæ£€æµ‹å¯è¾¾æ€§ä¸å¤©æ°”é£é™©ã€‚
  - æ•´åˆ Agentï¼šç»¼åˆè¾“å‡ºè¡Œç¨‹è¡¨ã€‚


### 2. å¯¹è¯æ¨¡å—ï¼ˆä¸æ˜¯è®°å¿†æ¨¡å—ï¼‰
- [ ] å·¦ä¾§å†å²ä¼šè¯åˆ—è¡¨æ”¯æŒç½®é¡¶ã€å–æ¶ˆç½®é¡¶ã€‚
- [ ] å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç›´æ¥ç»ˆæ­¢æœ¬æ¬¡å¯¹è¯ã€‚
- [ ] å¯ä»¥å¯¹ä»¥å¾€å‘èµ·çš„å¯¹è¯å†…å®¹ç¼–è¾‘ï¼Œç„¶åé‡æ–°å¯¹è¯ã€‚
- [ ] å¯¹è¯æ¡†é›†æˆç¤ºä¾‹ promptï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥é€‰æ‹©ï¼Œå¹¶ä¿®æ”¹å¡«å……åå³å¯å‘èµ·è¯·æ±‚ã€‚

### 3. ç”¨æˆ·æ¨¡å—
- [ ] å®Œå–„ç®¡ç†å‘˜çš„æƒé™ï¼Œä¾‹å¦‚ç¦ç”¨æŸä¸€ç”¨æˆ·ã€ç”¨æˆ·æˆæƒç­‰ç­‰ã€‚
- [ ] æ³¨å†Œæ—¶å¯¹æ‰‹æœºå·ä¸å¯†ç ç­‰çº§è¿›è¡Œæ ¡éªŒã€‚

### 4. å…¶ä»–æ¨¡å—
- [ ] å°†è·¯çº¿è§„åˆ’ç»“æœå¯¼å‡ºä¸º h5 é¡µé¢ï¼Œç„¶åå¯ä»¥æ‰‹æœºæ‰«ç å±•ç¤ºã€è°ƒèµ·æ‰‹æœºå¯¼èˆªã€‚
- [ ] æ”¯æŒè·³è½¬è‡³å„æ™¯ç‚¹è®¢å•æœåŠ¡ã€‚
- [ ] åœ°å›¾ä¸Šå•å‡»æŸä¸ªåœ°ç‚¹åï¼Œå±•ç¤ºå…¶è¯¦ç»†ä¿¡æ¯ï¼ˆå«å›¾ç‰‡ä¸æ–‡å­—è¯´æ˜ï¼‰ã€‚
- [ ] æ·»åŠ  Github é“¾æ¥åœ°å€ã€‚
- [ ] ç›®å‰OSMåœ°å›¾åœ¨åœ°ç‚¹å®šä½æ—¶ï¼Œæœ‰äº›åœ°ç‚¹çš„å®šä½ä¼šå‡ºç°è¾ƒå¤§çš„è¯¯å·®ï¼Œç›®å‰è¿˜æ²¡æœ‰å¾ˆå¥½çš„è§£å†³æ–¹æ³•ï¼ˆå› ä¸ºæœåŠ¡å™¨è¿˜åœ¨é¦™æ¸¯ï¼Œæ‰€ä»¥å°±å…ˆç”¨OSMåœ°å›¾ï¼‰ã€‚
- [ ] åŠ ä¸€ä¸ªæ˜¯å¦è‡ªåŠ¨æ¸²æŸ“åœ°å›¾çš„é€‰é¡¹ã€‚
- [ ] åŠ ä¸€ä¸ªå¸®åŠ©é¡µé¢ã€‚


---

## ğŸ“š æ ¸å¿ƒåŸºç¡€ä»£ç 

å«æœ‰ **AI Serviceã€MCPã€Function Call** è°ƒç”¨åŸºç¡€æ ¸å¿ƒä»£ç 

> å¯å‚è€ƒ [doc/coreBasicCode.md](doc/coreBasicCode.md) æ–‡ä»¶ 
